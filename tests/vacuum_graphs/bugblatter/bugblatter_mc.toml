[gammaloop_state]
state_name = "bugblatter_mc"

[graph]
from_state = false
momtrop_edge_weight = 0.75
is_vacuum = true
overwrite_graph_properties = true

[graph.graph_properties]
edge_src_dst_vertices = [
    [3, 0], 
    [4, 3], 
    [0, 1],
    [1, 4],
    [2, 5],
    [5, 4],
    [1, 2],
    [3, 5],
    [2, 0]
]
edge_masses = [
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0,
    0.0
]
edge_momentum_shifts = [
    [
        0.0,
        0.0,
        0.0
    ],
    [
        0.0,
        0.0,
        0.0
    ],
    [
        0.0,
        0.0,
        0.0
    ],
    [
        0.0,
        0.0,
        0.0
    ],
    [
        0.0,
        0.0,
        0.0
    ],
    [
        0.0,
        0.0,
        0.0
    ],
    [
        0.0,
        0.0,
        0.0
    ],
    [
        0.0,
        0.0,
        0.0
    ],
    [
        0.0,
        0.0,
        0.0
    ]
]
graph_external_vertices = []
graph_signature = [
    [1, 0, 0, 0], 
    [0, 1, 0, 0], 
    [0, 0, 1, 0],
    [0, 0, 0, 1],
    [1, 0, 0, -1],
    [0, 1, 0, -1],
    [0, 0, 1, -1],
    [-1, 1, 0, 0],
    [-1, 0, 1, 0],
]
momtrop_edge_weight = []
lmb_array = [
    [0, 1, 2, 3],
    [3, 6, 7, 8],
    [1, 6, 7, 8],
    [3, 5, 7, 8],
    [1, 5, 7, 8],
    [3, 5, 6, 8],
    [1, 5, 6, 8],
    [3, 5, 6, 7],
    [1, 5, 6, 7],
    [1, 3, 7, 8],
    [1, 3, 6, 8],
    [1, 3, 6, 7],
    [2, 6, 7, 8],
    [2, 5, 7, 8],
    [2, 5, 6, 8],
    [2, 5, 6, 7],
    [1, 2, 6, 8],
    [1, 2, 5, 8],
    [1, 2, 6, 7],
    [1, 2, 5, 7],
    [2, 3, 7, 8],
    [2, 3, 5, 8],
    [2, 3, 5, 7],
    [1, 2, 3, 8],
    [1, 2, 3, 7],
    [3, 4, 7, 8],
    [2, 3, 4, 7],
    [1, 4, 7, 8],
    [1, 2, 4, 7],
    [3, 4, 5, 8],
    [2, 3, 4, 5],
    [1, 4, 5, 8],
    [1, 2, 4, 5],
    [1, 3, 4, 8],
    [1, 2, 3, 4],
    [2, 4, 7, 8],
    [2, 4, 5, 8],
    [1, 2, 4, 8],
    [3, 4, 6, 7],
    [1, 4, 6, 7],
    [3, 4, 5, 6],
    [1, 4, 5, 6],
    [1, 3, 4, 6],
    [2, 4, 6, 7],
    [2, 4, 5, 6],
    [1, 2, 4, 6],
    [0, 6, 7, 8],
    [0, 5, 7, 8],
    [0, 5, 6, 8],
    [0, 5, 6, 7],
    [0, 1, 6, 8],
    [0, 1, 5, 8],
    [0, 1, 5, 6],
    [0, 3, 7, 8],
    [0, 3, 6, 7],
    [0, 3, 5, 8],
    [0, 3, 5, 6],
    [0, 1, 3, 8],
    [0, 1, 3, 6],
    [0, 4, 7, 8],
    [0, 4, 6, 7],
    [0, 4, 5, 8],
    [0, 4, 5, 6],
    [0, 1, 4, 8],
    [0, 1, 4, 6],
    [0, 2, 6, 7],
    [0, 2, 5, 7],
    [0, 2, 5, 6],
    [0, 1, 2, 6],
    [0, 1, 2, 5],
    [0, 2, 3, 7],
    [0, 2, 3, 5],
    [0, 2, 4, 7],
    [0, 2, 4, 5],
    [0, 1, 2, 4],
]

[model]
from_state = false
model_path = "/home/nic/Master/tropnis/kaapo_scalars.json"

[layered_integrator]
integrator_type = "madnis"
batch_size = 100000
learning_rate = 1e-3
use_scheduler = true
discrete_model = "transformer"

[integrator.madnis.transformer]
embedding_dim  = 64
feedforward_dim = 256
heads = 8
transformer_layers = 3
mlp_layers = 3
mlp_units = 256

[layered_parameterisation.layer_0]
parameterisation_type = "rkaapo"
# chem potential [3.141592653589793, 3.141592653589793, 3.141592653589793, 3.141592653589793, 0.0, 0.0, 0.0, 0.0, 0.0]
# no chem potential [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
mu = [3.141592653589793, 3.141592653589793, 3.141592653589793, 3.141592653589793, 0.0, 0.0, 0.0, 0.0, 0.0]
a = 0.5
b = 1.0

[layered_parameterisation.layer_1]
parameterisation_type = "mc_layer"
subtype = "fermi"
ose_exponent = 3.0
fermi_exponent = 0.5

[layered_integrand]
integrand_type = "kaapo"
path_to_example = "/home/nfink/thermal_integrand_examples/examples/bugblatterPQ"
# chem potential [6.283185307179586, 3.141592653589793, 1.0]
# no chem potential [6.283185307179586, 0.0, 1.0] 
params = [6.283185307179586, 3.141592653589793, 1.0]
use_prec = true
use_f128 = true
n_cores = 128
# chem potential 0.0290399
# no chem potential 0.714390
target_real = 0.0

[integrand.kaapo.symbolica_integrand_kwargs]
rotation_seed = 42
stability_tolerance = 1e-5
stability_abs_threshold = 1e-12
stability_abs_tolerance = 1e-15
escalate_large_weight_multiplier = 0.9
escalate_small_momentum_multiplier = 1e-3
escalate_large_momentum_multiplier = 1e3
n_shots = 3
force_rebuild = false
sum_orientations = true
runtime_summation = false

[integrand.kaapo.symbolica_integrand_prec_kwargs]
prec = 200
n_shots = 1
escalate_large_weight_multiplier = -1.0
escalate_small_momentum_multiplier = -1.0
escalate_large_momentum_multiplier = -1.0
sum_orientations = true
runtime_summation = false

# Parameters used in the tprog subcommand
[scripts.training_prog]
n_training_steps = 1000
n_samples = 100000
# Number of samples drawn after the training to compute the final result
n_samples_after_training = 10000000
# Training steps between callback of loss to console
n_log = 20
# Training steps between drawing n_samples samples to calculate the rel. std. (rsd)
# Will also output the result +- error and rsd to console
n_plot_rsd = 100
# Training steps between plotting the loss
n_plot_loss = 2
